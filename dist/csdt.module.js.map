{"version":3,"file":"csdt.module.js","sources":["../src/base.js","../src/parent.js","../src/child.js"],"sourcesContent":["import * as Y from 'yjs';\r\n\r\n//base CSDT object\r\n//both the parent and child implementation extend from this\r\nexport default class Base {\r\n  constructor() {\r\n    this.version = '0.1.0';\r\n    this.ydoc = new Y.Doc();\r\n\r\n    //ydoc recieve updates\r\n    document.addEventListener('CSDT-y-update', (e) => {\r\n      const update = e.detail;\r\n      Y.applyUpdate(this.ydoc, update);\r\n    });\r\n  }\r\n}\r\n","import Base from './base';\r\n\r\n//manages connections as a parent site\r\nexport class CSDTParent extends Base {\r\n  constructor(iframe) {\r\n    super();\r\n\r\n    this.iframe = iframe;\r\n\r\n    //ydoc send updates\r\n    this.ydoc.on('update', (update, _origin, _doc, _tr) => {\r\n      const event = new CustomEvent('CSDT-y-update', { detail: update });\r\n      this.iframe.contentDocument.dispatchEvent(event);\r\n    });\r\n  }\r\n\r\n  //returns a promise that resolves if the child site supports CSDT\r\n  //resolves with the child CSDT version number\r\n  checkSupport() {\r\n    return new Promise((resolve, _reject) => {\r\n      window.document.addEventListener('CSDT-response-check-support', (e) => resolve(e.detail), { once: true });\r\n\r\n      const event = new CustomEvent('CSDT-check-support');\r\n      this.iframe.contentDocument.dispatchEvent(event);\r\n    });\r\n  }\r\n\r\n  //returns a promise that resolves with data from the child site\r\n  openPortal(recievesThree = false, sendsThree = false) {\r\n    return new Promise((resolve, _reject) => {\r\n      window.document.addEventListener('CSDT-response-portal-open', (e) => resolve(e.detail), { once: true });\r\n\r\n      const data = {\r\n        recievesThree: recievesThree,\r\n        sendsThree: sendsThree,\r\n      };\r\n      const event = new CustomEvent('CSDT-portal-open', { detail: data });\r\n      this.iframe.contentDocument.dispatchEvent(event);\r\n    });\r\n  }\r\n}\r\n","import Base from './base';\r\n\r\n//manages connections as a child site\r\nexport class CSDTChild extends Base {\r\n  constructor() {\r\n    super();\r\n\r\n    //ydoc send updates\r\n    this.ydoc.on('update', (update, _origin, _doc, _tr) => {\r\n      const event = new CustomEvent('CSDT-y-update', { detail: update });\r\n      parent.document.dispatchEvent(event);\r\n    });\r\n\r\n    //tells the parent site we have CSDT support\r\n    document.addEventListener('CSDT-check-support', () => {\r\n      const response = new CustomEvent('CSDT-response-check-support', { detail: this.version });\r\n      parent.document.dispatchEvent(response);\r\n    });\r\n  }\r\n\r\n  //response to CSDT-portal-open\r\n  responsePortalOpen(hasReturnPortal = false, sendsThree = false, recievesThree = false) {\r\n    const data = {\r\n      hasReturnPortal: hasReturnPortal,\r\n      sendsThree: sendsThree,\r\n      recievesThree: recievesThree,\r\n    };\r\n    const response = new CustomEvent('CSDT-response-portal-open', { detail: data });\r\n    parent.document.dispatchEvent(response);\r\n  }\r\n}\r\n"],"names":["Base","this","version","ydoc","Y","Doc","document","addEventListener","e","applyUpdate","_this","detail","CSDTParent","iframe","on","update","_origin","_doc","_tr","event","CustomEvent","contentDocument","dispatchEvent","checkSupport","Promise","resolve","_reject","window","once","_this2","openPortal","recievesThree","sendsThree","_this3","CSDTChild","parent","response","responsePortalOpen","hasReturnPortal"],"mappings":"8MAIqBA,EACnB,sBACEC,KAAKC,QAAU,QACfD,KAAKE,KAAO,IAAIC,EAAEC,IAGlBC,SAASC,iBAAiB,gBAAiB,SAACC,GAE1CJ,EAAEK,YAAYC,EAAKP,KADJK,EAAEG,WCRVC,cACX,WAAYC,SAAQ,OAClBH,sBAEKG,OAASA,EAGdH,EAAKP,KAAKW,GAAG,SAAU,SAACC,EAAQC,EAASC,EAAMC,GAC7C,IAAMC,EAAQ,IAAIC,YAAY,gBAAiB,CAAET,OAAQI,IACzDL,EAAKG,OAAOQ,gBAAgBC,cAAcH,cAThD,2BAeEI,aAAA,sBACE,WAAWC,QAAQ,SAACC,EAASC,GAC3BC,OAAOrB,SAASC,iBAAiB,8BAA+B,SAACC,UAAMiB,EAAQjB,EAAEG,SAAS,CAAEiB,MAAM,IAElG,IAAMT,EAAQ,IAAIC,YAAY,sBAC9BS,EAAKhB,OAAOQ,gBAAgBC,cAAcH,QAK9CW,WAAA,SAAWC,EAAuBC,cAChC,gBADSD,IAAAA,GAAgB,YAAOC,IAAAA,GAAa,OAClCR,QAAQ,SAACC,EAASC,GAC3BC,OAAOrB,SAASC,iBAAiB,4BAA6B,SAACC,UAAMiB,EAAQjB,EAAEG,SAAS,CAAEiB,MAAM,IAEhG,IAIMT,EAAQ,IAAIC,YAAY,mBAAoB,CAAET,OAJvC,CACXoB,cAAeA,EACfC,WAAYA,KAGdC,EAAKpB,OAAOQ,gBAAgBC,cAAcH,SAlChBnB,GCAnBkC,cACX,mBAAc,OACZxB,sBAGKP,KAAKW,GAAG,SAAU,SAACC,EAAQC,EAASC,EAAMC,GAC7C,IAAMC,EAAQ,IAAIC,YAAY,gBAAiB,CAAET,OAAQI,IACzDoB,OAAO7B,SAASgB,cAAcH,KAIhCb,SAASC,iBAAiB,qBAAsB,WAC9C,IAAM6B,EAAW,IAAIhB,YAAY,8BAA+B,CAAET,OAAQD,EAAKR,UAC/EiC,OAAO7B,SAASgB,cAAcc,iCAKlCC,mBAAA,SAAmBC,EAAyBN,EAAoBD,YAA7CO,IAAAA,GAAkB,YAAON,IAAAA,GAAa,YAAOD,IAAAA,GAAgB,GAC9E,IAKMK,EAAW,IAAIhB,YAAY,4BAA6B,CAAET,OALnD,CACX2B,gBAAiBA,EACjBN,WAAYA,EACZD,cAAeA,KAGjBI,OAAO7B,SAASgB,cAAcc,OAzBHpC"}