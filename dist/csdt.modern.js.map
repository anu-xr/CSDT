{"version":3,"file":"csdt.modern.js","sources":["../src/base.js","../src/parent.js","../src/child.js"],"sourcesContent":["import * as Y from 'yjs';\r\n\r\n//base CSDT object\r\n//both the parent and child implementation extend from this\r\nexport default class Base {\r\n  constructor() {\r\n    this.version = '0.1.0';\r\n    this.ydoc = new Y.Doc();\r\n\r\n    //ydoc recieve updates\r\n    document.addEventListener('CSDT-y-update', (e) => {\r\n      const update = e.detail;\r\n      Y.applyUpdate(this.ydoc, update);\r\n    });\r\n  }\r\n}\r\n","import Base from './base';\r\n\r\n//manages connections as a parent site\r\nexport class CSDTParent extends Base {\r\n  constructor(iframe) {\r\n    super();\r\n\r\n    this.iframe = iframe;\r\n\r\n    //ydoc send updates\r\n    this.ydoc.on('update', (update, _origin, _doc, _tr) => {\r\n      const event = new CustomEvent('CSDT-y-update', { detail: update });\r\n      this.iframe.contentDocument.dispatchEvent(event);\r\n    });\r\n  }\r\n\r\n  //returns a promise that resolves if the child site supports CSDT\r\n  //resolves with the child CSDT version number\r\n  checkSupport() {\r\n    return new Promise((resolve, _reject) => {\r\n      window.document.addEventListener('CSDT-response-check-support', (e) => resolve(e.detail), { once: true });\r\n\r\n      const event = new CustomEvent('CSDT-check-support');\r\n      this.iframe.contentDocument.dispatchEvent(event);\r\n    });\r\n  }\r\n\r\n  //returns a promise that resolves with data from the child site\r\n  openPortal(recievesThree = false, sendsThree = false) {\r\n    return new Promise((resolve, _reject) => {\r\n      window.document.addEventListener('CSDT-response-portal-open', (e) => resolve(e.detail), { once: true });\r\n\r\n      const data = {\r\n        recievesThree: recievesThree,\r\n        sendsThree: sendsThree,\r\n      };\r\n      const event = new CustomEvent('CSDT-portal-open', { detail: data });\r\n      this.iframe.contentDocument.dispatchEvent(event);\r\n    });\r\n  }\r\n}\r\n","import Base from './base';\r\n\r\n//manages connections as a child site\r\nexport class CSDTChild extends Base {\r\n  constructor() {\r\n    super();\r\n\r\n    //ydoc send updates\r\n    this.ydoc.on('update', (update, _origin, _doc, _tr) => {\r\n      const event = new CustomEvent('CSDT-y-update', { detail: update });\r\n      parent.document.dispatchEvent(event);\r\n    });\r\n\r\n    //tells the parent site we have CSDT support\r\n    document.addEventListener('CSDT-check-support', () => {\r\n      const response = new CustomEvent('CSDT-response-check-support', { detail: this.version });\r\n      parent.document.dispatchEvent(response);\r\n    });\r\n  }\r\n\r\n  //response to CSDT-portal-open\r\n  responsePortalOpen(hasReturnPortal = false, sendsThree = false, recievesThree = false) {\r\n    const data = {\r\n      hasReturnPortal: hasReturnPortal,\r\n      sendsThree: sendsThree,\r\n      recievesThree: recievesThree,\r\n    };\r\n    const response = new CustomEvent('CSDT-response-portal-open', { detail: data });\r\n    parent.document.dispatchEvent(response);\r\n  }\r\n}\r\n"],"names":["Base","constructor","this","version","ydoc","Y","Doc","document","addEventListener","e","applyUpdate","detail","CSDTParent","iframe","super","on","update","_origin","_doc","_tr","event","CustomEvent","contentDocument","dispatchEvent","checkSupport","Promise","resolve","_reject","window","once","openPortal","recievesThree","sendsThree","CSDTChild","parent","response","responsePortalOpen","hasReturnPortal"],"mappings":"4BAIqBA,EACnBC,cACEC,KAAKC,QAAU,QACfD,KAAKE,KAAO,IAAIC,EAAEC,IAGlBC,SAASC,iBAAiB,gBAAkBC,IAE1CJ,EAAEK,YAAYR,KAAKE,KADJK,EAAEE,iBCRVC,UAAmBZ,EAC9BC,YAAYY,GACVC,QAEAZ,KAAKW,OAASA,EAGdX,KAAKE,KAAKW,GAAG,SAAU,CAACC,EAAQC,EAASC,EAAMC,KAC7C,MAAMC,EAAQ,IAAIC,YAAY,gBAAiB,CAAEV,OAAQK,IACzDd,KAAKW,OAAOS,gBAAgBC,cAAcH,KAM9CI,eACE,WAAWC,QAAQ,CAACC,EAASC,KAC3BC,OAAOrB,SAASC,iBAAiB,8BAAgCC,GAAMiB,EAAQjB,EAAEE,QAAS,CAAEkB,MAAM,IAElG,MAAMT,EAAQ,IAAIC,YAAY,sBAC9BnB,KAAKW,OAAOS,gBAAgBC,cAAcH,KAK9CU,WAAWC,GAAgB,EAAOC,GAAa,GAC7C,WAAWP,QAAQ,CAACC,EAASC,KAC3BC,OAAOrB,SAASC,iBAAiB,4BAA8BC,GAAMiB,EAAQjB,EAAEE,QAAS,CAAEkB,MAAM,IAEhG,MAIMT,EAAQ,IAAIC,YAAY,mBAAoB,CAAEV,OAJvC,CACXoB,cAAeA,EACfC,WAAYA,KAGd9B,KAAKW,OAAOS,gBAAgBC,cAAcH,YClCnCa,UAAkBjC,EAC7BC,cACEa,QAGAZ,KAAKE,KAAKW,GAAG,SAAU,CAACC,EAAQC,EAASC,EAAMC,KAC7C,MAAMC,EAAQ,IAAIC,YAAY,gBAAiB,CAAEV,OAAQK,IACzDkB,OAAO3B,SAASgB,cAAcH,KAIhCb,SAASC,iBAAiB,qBAAsB,KAC9C,MAAM2B,EAAW,IAAId,YAAY,8BAA+B,CAAEV,OAAQT,KAAKC,UAC/E+B,OAAO3B,SAASgB,cAAcY,KAKlCC,mBAAmBC,GAAkB,EAAOL,GAAa,EAAOD,GAAgB,GAC9E,MAKMI,EAAW,IAAId,YAAY,4BAA6B,CAAEV,OALnD,CACX0B,gBAAiBA,EACjBL,WAAYA,EACZD,cAAeA,KAGjBG,OAAO3B,SAASgB,cAAcY"}